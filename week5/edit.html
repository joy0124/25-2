<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Friend Manager · 수정</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-body-tertiary">
<main class="container py-4">
  <h1 class="h4 mb-3 age-title">친구 수정</h1>

  <form id="editForm" novalidate>
    <div class="row g-3 field">
      <!-- 이름 -->
      <div class="col-md-6 field">
        <label for="name" class="form-label">이름 <span class="text-danger">*</span></label>
        <input id="name" name="name" type="text" class="form-control" placeholder="홍길동" required>
        <div class="invalid-feedback">이름은 2자 이상 입력하세요.</div>
      </div>

      <!-- 전화 -->
      <div class="col-md-6 field">
        <label for="phone" class="form-label">전화 <span class="text-danger">*</span></label>
        <input id="phone" name="phone" type="text" class="form-control" placeholder="010-1234-5678" required>
        <div class="invalid-feedback">전화번호는 010-0000-0000 형식으로 입력하세요.</div>
      </div>

      <!-- 이메일 -->
      <div class="col-md-6 field">
        <label for="email" class="form-label">이메일 <span class="text-danger">*</span></label>
        <input id="email" name="email" type="email" class="form-control" placeholder="you@example.com" required>
        <div class="invalid-feedback">올바른 이메일 주소를 입력하세요.</div>
      </div>

      <!-- 그룹 -->
      <div class="col-md-6 field">
        <label for="group" class="form-label">그룹 <span class="text-danger">*</span></label>
        <select id="group" name="group" class="form-select" required>
          <option value="">선택...</option>
          <option>여내기</option>
          <option>남내기</option>
          <option>여새섬</option>
          <option>남새섬</option>
          <option>기타</option>
        </select>
        <div class="invalid-feedback">그룹을 선택하세요.</div>
      </div>

      <!-- 생일 -->
      <div class="col-md-6 field">
        <label for="bday" class="form-label">생일 <span class="text-danger">*</span></label>
        <input id="bday" name="bday" type="date" class="form-control" required>
        <div class="invalid-feedback">유효한 생일을 선택하세요(미래 불가).</div>
      </div>

      
      <div class="col-12 field">
        <label for="note" class="form-label">메모 (선택)</label>
        <textarea id="note" name="note" class="form-control" rows="3" maxlength="200" placeholder="최대 200자"></textarea>
        <div class="form-text">남기는 메모는 최대 200자입니다.</div>
      </div>
    </div>

    <hr class="my-4">

    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-primary">확인</button>
      <a class="btn btn-outline-secondary" href="index.html">취소</a>
    </div>
  </form>
</main>

<script>

  const KEY = 'friendsData';
  const params = new URLSearchParams(location.search);
  const id = Number(params.get('id'));              
  const list = JSON.parse(localStorage.getItem(KEY) || '[]');
  const rec  = list.find(x => Number(x.id) === id) || {};

  const form  = document.getElementById('editForm');
  const nameI = document.getElementById('name');
  const phone = document.getElementById('phone');
  const email = document.getElementById('email');
  const group = document.getElementById('group');
  const bday  = document.getElementById('bday');
  const note  = document.getElementById('note');


  nameI.value = rec.name || '';
  phone.value = rec.phone || '';
  email.value = rec.email || '';
  group.value = rec.group || '';
  bday.value  = rec.bday || '';
  note.value  = rec.note || '';


  function validateName() {
    const ok = (nameI.value || '').trim().length >= 2;
    nameI.setCustomValidity(ok ? '' : '이름 2자 이상');
    return ok;
  }
  function validatePhone() {
    const re = /^010-\d{4}-\d{4}$/;
    const ok = re.test((phone.value || '').trim());
    phone.setCustomValidity(ok ? '' : '형식 오류');
    return ok;
  }
  function validateEmail() {
    const v = (email.value || '').trim(); email.value = v;
    const ok = email.checkValidity();
    email.setCustomValidity(ok ? '' : '형식 오류');
    return ok;
  }
  function validateGroup() {
    const ok = !!group.value;
    group.setCustomValidity(ok ? '' : '필수');
    return ok;
  }
  function validateBday() {
    const val = bday.value;
    if (!val) { bday.setCustomValidity('필수'); return false; }
    const chosen = new Date(val);
    const today = new Date(); today.setHours(0,0,0,0);
    const ok = chosen <= today;
    bday.setCustomValidity(ok ? '' : '미래 불가');
    return ok;
  }

  [nameI, phone, email, group, bday].forEach(el=>{
    el.addEventListener('blur', ()=>{
      (el===nameI)&&validateName();
      (el===phone)&&validatePhone();
      (el===email)&&validateEmail();
      (el===group)&&validateGroup();
      (el===bday)&&validateBday();
      form.classList.add('was-validated');
    });
  });


  form.addEventListener('submit', (e)=>{
    e.preventDefault();
    const ok = validateName() && validatePhone() && validateEmail() && validateGroup() && validateBday();
    form.classList.add('was-validated');
    if (!ok) return;

    if (confirm('게시물을 수정할까요?')) {
      
      location.href = 'index.html';
    }
  });
</script>
</body>
</html>
